/**
 * WHMCS Core Scripts - Minified
 * Essential JavaScript functionality for WHMCS templates
 */

(function(window, document) {
    'use strict';
    
    // WHMCS namespace
    window.WHMCS = window.WHMCS || {};
    
    // Utility functions
    WHMCS.utils = {
        
        // Get element by ID
        getElementById: function(id) {
            return document.getElementById(id);
        },
        
        // Add event listener with cross-browser support
        addEvent: function(element, event, callback) {
            if (element.addEventListener) {
                element.addEventListener(event, callback, false);
            } else if (element.attachEvent) {
                element.attachEvent('on' + event, callback);
            }
        },
        
        // Remove event listener
        removeEvent: function(element, event, callback) {
            if (element.removeEventListener) {
                element.removeEventListener(event, callback, false);
            } else if (element.detachEvent) {
                element.detachEvent('on' + event, callback);
            }
        },
        
        // AJAX request handler
        ajax: function(options) {
            var xhr = new XMLHttpRequest();
            var method = options.method || 'GET';
            var url = options.url;
            var data = options.data || null;
            var success = options.success || function() {};
            var error = options.error || function() {};
            
            xhr.open(method, url, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        success(xhr.responseText, xhr);
                    } else {
                        error(xhr);
                    }
                }
            };
            
            xhr.send(data);
        },
        
        // Convert form data to URL encoded string
        serializeForm: function(form) {
            var params = [];
            var elements = form.elements;
            
            for (var i = 0; i < elements.length; i++) {
                var element = elements[i];
                var name = element.name;
                var value = element.value;
                
                if (name && !element.disabled) {
                    if (element.type === 'checkbox' || element.type === 'radio') {
                        if (element.checked) {
                            params.push(encodeURIComponent(name) + '=' + encodeURIComponent(value));
                        }
                    } else if (element.type !== 'button' && element.type !== 'submit') {
                        params.push(encodeURIComponent(name) + '=' + encodeURIComponent(value));
                    }
                }
            }
            
            return params.join('&');
        }
    };
    
    // Form validation
    WHMCS.validation = {
        
        // Validate email format
        email: function(email) {
            var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        },
        
        // Validate required fields
        required: function(value) {
            return value !== null && value !== undefined && value.toString().trim() !== '';
        },
        
        // Validate minimum length
        minLength: function(value, min) {
            return value && value.length >= min;
        },
        
        // Validate maximum length
        maxLength: function(value, max) {
            return value && value.length <= max;
        },
        
        // Password strength validation
        password: function(password) {
            // At least 8 characters, 1 uppercase, 1 lowercase, 1 number
            var regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,}$/;
            return regex.test(password);
        }
    };
    
    // Cart functionality
    WHMCS.cart = {
        
        // Add item to cart
        addItem: function(itemId, options) {
            var data = 'action=add&id=' + encodeURIComponent(itemId);
            
            if (options) {
                for (var key in options) {
                    if (options.hasOwnProperty(key)) {
                        data += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(options[key]);
                    }
                }
            }
            
            WHMCS.utils.ajax({
                url: 'cart.php',
                method: 'POST',
                data: data,
                success: function(response) {
                    // Handle success
                    WHMCS.cart.updateCartDisplay();
                },
                error: function() {
                    console.error('Failed to add item to cart');
                }
            });
        },
        
        // Remove item from cart
        removeItem: function(itemId) {
            WHMCS.utils.ajax({
                url: 'cart.php',
                method: 'POST',
                data: 'action=remove&id=' + encodeURIComponent(itemId),
                success: function() {
                    WHMCS.cart.updateCartDisplay();
                },
                error: function() {
                    console.error('Failed to remove item from cart');
                }
            });
        },
        
        // Update cart display
        updateCartDisplay: function() {
            // Reload cart items or update display
            window.location.reload();
        }
    };
    
    // Modal functionality
    WHMCS.modal = {
        
        // Show modal
        show: function(content, options) {
            options = options || {};
            var modal = document.createElement('div');
            modal.className = 'whmcs-modal';
            modal.innerHTML = 
                '<div class="whmcs-modal-backdrop"></div>' +
                '<div class="whmcs-modal-content">' +
                    '<div class="whmcs-modal-header">' +
                        '<h3>' + (options.title || 'Modal') + '</h3>' +
                        '<button class="whmcs-modal-close">&times;</button>' +
                    '</div>' +
                    '<div class="whmcs-modal-body">' + content + '</div>' +
                '</div>';
            
            document.body.appendChild(modal);
            
            // Close functionality
            var closeBtn = modal.querySelector('.whmcs-modal-close');
            var backdrop = modal.querySelector('.whmcs-modal-backdrop');
            
            WHMCS.utils.addEvent(closeBtn, 'click', function() {
                WHMCS.modal.hide(modal);
            });
            
            WHMCS.utils.addEvent(backdrop, 'click', function() {
                WHMCS.modal.hide(modal);
            });
            
            return modal;
        },
        
        // Hide modal
        hide: function(modal) {
            if (modal && modal.parentNode) {
                modal.parentNode.removeChild(modal);
            }
        }
    };
    
    // Domain checker functionality
    WHMCS.domainChecker = {
        
        // Check domain availability
        check: function(domain, tlds) {
            var data = 'domain=' + encodeURIComponent(domain);
            
            if (tlds && tlds.length > 0) {
                data += '&tlds=' + encodeURIComponent(tlds.join(','));
            }
            
            WHMCS.utils.ajax({
                url: 'domainchecker.php',
                method: 'POST',
                data: data,
                success: function(response) {
                    // Handle domain check results
                    console.log('Domain check results:', response);
                },
                error: function() {
                    console.error('Domain check failed');
                }
            });
        }
    };
    
    // Initialize core functionality when DOM is ready
    function init() {
        // Auto-submit forms with data-auto-submit attribute
        var autoSubmitForms = document.querySelectorAll('form[data-auto-submit]');
        for (var i = 0; i < autoSubmitForms.length; i++) {
            WHMCS.utils.addEvent(autoSubmitForms[i], 'change', function() {
                this.submit();
            });
        }
        
        // Confirm delete actions
        var deleteLinks = document.querySelectorAll('a[data-confirm], button[data-confirm]');
        for (var j = 0; j < deleteLinks.length; j++) {
            WHMCS.utils.addEvent(deleteLinks[j], 'click', function(e) {
                var message = this.getAttribute('data-confirm') || 'Are you sure?';
                if (!confirm(message)) {
                    e.preventDefault();
                    return false;
                }
            });
        }
        
        // Password strength indicator
        var passwordInputs = document.querySelectorAll('input[type="password"][data-strength]');
        for (var k = 0; k < passwordInputs.length; k++) {
            WHMCS.utils.addEvent(passwordInputs[k], 'input', function() {
                var strength = WHMCS.validation.password(this.value);
                var indicator = document.querySelector('[data-strength-for="' + this.id + '"]');
                if (indicator) {
                    indicator.className = strength ? 'strength-strong' : 'strength-weak';
                    indicator.textContent = strength ? 'Strong' : 'Weak';
                }
            });
        }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        WHMCS.utils.addEvent(document, 'DOMContentLoaded', init);
    } else {
        init();
    }
    
})(window, document);